/* empty css              */(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&r(i)}).observe(document,{childList:!0,subtree:!0});function s(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(n){if(n.ep)return;n.ep=!0;const o=s(n);fetch(n.href,o)}})();const E=document.getElementById("step1"),I=document.getElementById("step2"),B=document.getElementById("success"),k=document.getElementById("inviterForm"),u=document.getElementById("prevBtn"),c=document.getElementById("nextBtn"),d=document.getElementById("submitBtn"),_=document.getElementById("loading"),x=document.getElementById("error"),S=document.getElementById("mainContent"),N=document.getElementById("errorMessage"),L=document.querySelectorAll(".tab-btn"),P=document.querySelectorAll(".tab-pane"),g=document.getElementById("closeness"),h=document.querySelector(".slider-value");let y=1,a="basic";const v="https://kprqdwwjywxtkariwjyd.supabase.co",w="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImtwcnFkd3dqeXd4dGthcml3anlkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU4MDYxMjYsImV4cCI6MjA3MTM4MjEyNn0.fuxy0dHa0D-DqyCopteghMn_HMrFagPm1NDMQF-29Uk";document.addEventListener("DOMContentLoaded",function(){j(),T(),O()});async function O(){try{const t=b();if(!t){m("Davet token bulunamadı");return}console.log("🔍 Davet token doğrulanıyor:",t);const e=await fetch(`${v}/functions/v1/invite-verify`,{method:"POST",headers:{"Content-Type":"application/json",apikey:w,authorization:`Bearer ${w}`},body:JSON.stringify({token:t,inviter:{first_name:"",last_name:""}})});if(e.ok){const s=await e.json();s.ok!==!1?(F(),console.log("✅ Davet token doğrulandı")):m(s.reason==="not_found"?"Davet bağlantısı bulunamadı":"Davet bağlantısı geçersiz")}else{const s=await e.json();m(s.error||"Token doğrulanamadı")}}catch(t){console.error("Token doğrulama hatası:",t),m("Davet bağlantısı doğrulanamadı: "+t.message)}}function F(){_.style.display="none",x.style.display="none",S.style.display="block"}function m(t){_.style.display="none",x.style.display="block",S.style.display="none",N.textContent=t}function j(){k.addEventListener("submit",A),u&&u.addEventListener("click",J),c&&c.addEventListener("click",q),d&&d.addEventListener("click",U),L.forEach(t=>{t.addEventListener("click",()=>l(t.dataset.tab))}),g&&g.addEventListener("input",T)}function A(t){t.preventDefault();const e=new FormData(k),s={first_name:e.get("inviterFirstName"),last_name:e.get("inviterLastName"),email:e.get("inviterEmail")};G(s)}function p(t){E.classList.remove("active"),I.classList.remove("active"),B.classList.remove("active"),t===1?(E.classList.add("active"),y=1):t===2?(I.classList.add("active"),y=2,D()):t==="success"&&(B.classList.add("active"),y="success")}function J(){y===2&&p(1)}function q(){a==="basic"?l("work"):a==="work"?l("personal"):a==="personal"?l("social"):a==="social"?l("experience"):a==="experience"&&(l("future"),z())}function l(t){L.forEach(e=>{e.classList.remove("active"),e.dataset.tab===t&&e.classList.add("active")}),P.forEach(e=>{e.classList.remove("active"),e.id===t&&e.classList.add("active")}),a=t,D()}function D(){a==="basic"?(u.style.display="block",c.style.display="block",d.style.display="none"):a==="future"?(u.style.display="block",c.style.display="none",d.style.display="block"):(u.style.display="block",c.style.display="block",d.style.display="none")}function z(){d.style.display="block",c.style.display="none"}function T(){h&&g&&(h.textContent=g.value)}async function U(){try{const t=V();if(!Y(t)){alert("Lütfen zorunlu alanları doldurun.");return}const e=document.getElementById("submitBtn"),s=e.textContent;e.textContent="Gönderiliyor...",e.disabled=!0;const r=window.inviteData;if(!r)throw new Error("Davet bilgileri bulunamadı");const n=b(),o=await fetch(`${v}/functions/v1/invite-submit`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:n,inviter_contact_id:r.inviter_contact_id,contact:t})});if(o.ok){const i=await o.json();if(i.ok)C("Kişi başarıyla eklendi!"),setTimeout(()=>{p("success")},1500);else throw new Error(i.error||"Kişi eklenemedi")}else{const i=await o.json();throw new Error(i.error||"API error")}}catch(t){console.error("Submit error:",t),f("Gönderim sırasında hata oluştu: "+t.message)}finally{const t=document.getElementById("submitBtn");t.textContent=originalText,t.disabled=!1}}function V(){return{first_name:document.getElementById("firstName").value,last_name:document.getElementById("lastName").value,closeness:document.getElementById("closeness").value,age:document.getElementById("age").value,hometown:document.getElementById("hometown").value,current_city:document.getElementById("currentCity").value,email:document.getElementById("email").value,phone:document.getElementById("phone").value,summary:document.getElementById("summary").value,current_title:document.getElementById("currentTitle").value,current_company:document.getElementById("currentCompany").value,university:document.getElementById("university").value,education:document.getElementById("education").value,past_experiences:document.getElementById("pastExperiences").value,expertise_tags:document.getElementById("expertiseTags").value,service_tags:document.getElementById("serviceTags").value,sectors:document.getElementById("sectors").value,traits:document.getElementById("traits").value,principles:document.getElementById("principles").value,goals:document.getElementById("goals").value,vision:document.getElementById("vision").value,hobbies:document.getElementById("hobbies").value,languages:document.getElementById("languages").value,is_mentor:document.getElementById("isMentor").checked,volunteering:document.getElementById("volunteering").value,turning_points:document.getElementById("turningPoints").value,big_challenges:document.getElementById("bigChallenges").value,big_lessons:document.getElementById("bigLessons").value,goals_5y:document.getElementById("goals5y").value,goals_10y:document.getElementById("goals10y").value,approach_new_ideas:document.getElementById("approachNewIdeas").value,willing_to_invest:document.getElementById("willingToInvest").checked,willing_to_partner:document.getElementById("willingToPartner").checked,collaboration_areas:document.getElementById("collaborationAreas").value}}function Y(t){return!(!t.first_name.trim()||!t.last_name.trim())}function b(){return new URLSearchParams(window.location.search).get("t")}async function G(t){try{const e=document.querySelector('#inviterForm button[type="submit"]'),s=e.textContent;e.textContent="Doğrulanıyor...",e.disabled=!0;const r=b(),n=await fetch(`${v}/functions/v1/invite-verify`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:r,inviter:t})});if(n.ok){const o=await n.json();if(o.ok)window.inviteData=o,C("Doğrulama başarılı! İkinci adıma geçiliyor..."),setTimeout(()=>{p(2)},1500);else{let i="Bu bilgilerle ağ listesinde kişi bulunamadı.";o.reason==="ambiguous"&&(i="Birden fazla eşleşen kişi bulundu. Lütfen e-posta adresinizi de girin."),f(i)}}else{const o=await n.json();throw new Error(o.error||"API error")}}catch(e){console.error("Validation error:",e),f("Doğrulama sırasında hata oluştu: "+e.message)}finally{const e=document.querySelector('#inviterForm button[type="submit"]');e.textContent=originalText,e.disabled=!1}}function C(t){const e=document.createElement("div");e.className="message success-message",e.textContent=t;const s=document.getElementById("inviterForm");s.insertBefore(e,s.firstChild),setTimeout(()=>{e.remove()},3e3)}function f(t){const e=document.createElement("div");e.className="message error-message",e.textContent=t;const s=document.getElementById("inviterForm");s.insertBefore(e,s.firstChild),setTimeout(()=>{e.remove()},5e3)}const M=document.createElement("style");M.textContent=`
    .message {
        padding: 12px 16px;
        border-radius: 8px;
        margin-bottom: 16px;
        font-weight: 500;
    }
    
    .success-message {
        background: #d1fae5;
        color: #065f46;
        border: 1px solid #a7f3d0;
    }
    
    .error-message {
        background: #fee2e2;
        color: #991b1b;
        border: 1px solid #fecaca;
    }
`;document.head.appendChild(M);
